<link rel="import" href="bower_components/polymer/polymer.html">
<link rel="stylesheet" href="bower_components/icons/icons.css">

<polymer-element name="tef-button" on-click="{{onClick}}" attributes ="size type toggle active disabled">
    <template>
    	
    	<style>
		.tef-button ::content [data-icon]+span {
			margin-left: 7px;
		}
		.tef-button ::content span+[data-icon]{
			margin-left: 7px;
		}
		.tef-button ::content [data-icon]:before{
			position: relative;
			font-size: 24px;
			line-height: 0;
			top: 3px;
		}
    	</style>
    	<tef-core id="core"></tef-core>

	    <button id="button" class ="tef-button {{size}} {{type}}">
			<content></content>
		</button>
	</template>
	<script>

		Polymer({			
			applyAuthorStyles: true,
			size: "",
			type: "",			
			publish: {
				toggle:{
					value: false,
					reflect: true
				},
				active:{
					value: false,
					reflect: true
				},
				disabled:{
					value:false,
					reflect: true
				}
			},

			activeChanged: function(oldValue, newValue){
				var button = this.$.button;
				if (newValue){
					this.$.core.addClass(button, "active");					
					this.fire("activated");
				}else{
					this.$.core.removeClass(button, "active")					
					this.fire("deactivated");
				}
			},
			
			disabledChanged: function(oldValue, newValue) {
				var button = this.$.button;
				if (newValue) this.$.core.addClass(button, "disabled");
				else this.$.core.removeClass(button, "disabled");
			},

			onClick: function(){
				if (!this.disabled) {
					if (this.toggle){
						var button = this.$.button;
						this.active = !this.active;
					}else{
						this.fire("clicked");//Could be pressed						
					}
				}
			},
			attached: function(){
				var href;
				if (this.$.core.isReady){//If core has already loaded and has the correct brand
					href = "bower_components/buttons/css/buttons." + this.$.core.brand +".min.css";
					this.addDinamicCss(href);
				}
				else{
					this.$.core.addEventListener("ready", function(){//If not, we register it as a callback to the ready event
						href = "bower_components/buttons/css/buttons." + this.$.core.brand +".min.css";
						this.addDinamicCss(href);
					}.bind(this));
				}
				
			},
			addDinamicCss: function(href){
				var isOpera = !!window.opera || navigator.userAgent.indexOf(' OPR/') >= 0;				    
				var isFirefox = typeof InstallTrigger !== 'undefined';
				var isSafari = Object.prototype.toString.call(window.HTMLElement).indexOf('Constructor') > 0;				    
				var isChrome = !!window.chrome && !isOpera;              // Chrome 1+
				var isIE = /*@cc_on!@*/false || !!document.documentMode; // At least IE6
				
				var link = document.createElement('link');
				link.id = "button_style";
				link.type = "text/css"				
				link.rel = 'stylesheet';
				link.href = href;				
				if (!isFirefox){
					if (this.$.button_style != null)
						this.shadowRoot.removeChild(this.$.button-style);
					this.shadowRoot.appendChild(link);
					this.element.convertSheetsToStyles(this.shadowRoot);
				}else{
					 if(document.getElementById("button_style") == null){
						document.querySelector("head").appendChild(link);
					}else{
						document.getElementById("button_style").href = href;
					}
				}
			}	
		});
	</script>	
</polymer-element>