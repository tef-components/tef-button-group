<link rel="import" href="../tef-button/tef-button.html">

<polymer-element name="tef-button-group" attributes="size toggle single disabled">

    <template>
        <link id="myCss" rel="stylesheet" href="../button-groups/css/button-groups.min.css">

		<ul class="tef-button-group">
			<content select="tef-button"></content>
		</ul>
	</template>
	<script>
		Polymer({
			toggle: false,
			single: false,
			size: "",
			publish: {
				disabled:{
					value: false,
					reflect: true
				}
			},
			disabledChanged: function(oldValue, newValue){				
				if (newValue){//If disabled, we add disabled to all buttons
					for (var i = 0; i < this.children.length; i++) this.children[i].setAttribute("disabled", "");
					
				}else{//If !disabled, we remove disabled from all buttons
					for (var i = 0; i < children.length; i++) this.children[i].removeAttribute("disabled", "");
				}
			},
			attached: function(){
				var selected = null;
				this.changeCssSelectors(".tef-button-group ::content>*");
				this.changeCssSelectors(".tef-button-group ::content>*:first-child::shadow .tef-button");
				this.changeCssSelectors(".tef-button-group ::content>*:last-child::shadow .tef-button");
				this.changeCssSelectors(".tef-button-group ::content ::shadow .tef-button");
				this.changeCssSelectors(".tef-button-group ::content ::shadow>.tef-button");
				this.changeCssSelectors(".tef-button-group ::content tef-button + tef-button", ".tef-button-group>.tef-button+.tef-button");
				
				if (this.toggle || this.size != ""){//We only need to iterate when this happens
					for (var i = 0; i < this.children.length; i++){						
												
						if (this.toggle) this.children[i].setAttribute("toggle", "");

						if (this.size != "") this.children[i].setAttribute("size", this.size);
						
						if (this.toggle && this.single){//If single, then only one button can be toggled
							this.children[i].addEventListener("activated",function(){
								if (selected != null){
									selected.removeAttribute("active");
								}
								selected = this;								
							});

							this.children[i].addEventListener("deactivated",function(){
								if (selected == this) 
									selected = null;							
							});
						}
					}
				}
			},

			changeCssSelectors: function(newClass, oldClass){
				if (!oldClass){
					oldClass = newClass;
					oldClass = oldClass.replace(/\s{0,}::shadow/g, "");
					oldClass = oldClass.replace(/\s{0,}::content/g, "");
					oldClass = oldClass.replace(/\s{2,}/g, " ");					
				}
				if (this.$.myCss.innerHTML.indexOf(oldClass) == -1)
					console.log("Css '"+oldClass+"' not found");
				this.$.myCss.innerHTML = this.$.myCss.innerHTML.replace(oldClass, newClass);
			}
		});			
			
	</script>	
</polymer-element>